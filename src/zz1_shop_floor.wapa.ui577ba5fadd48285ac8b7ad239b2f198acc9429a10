sap.ui.define([                                                                                                                                                                                                                                                
    "sap/m/MessageToast",                                                                                                                                                                                                                                      
    "sap/m/MessageBox",                                                                                                                                                                                                                                        
	"sap/ui/model/odata/v2/ODataModel"                                                                                                                                                                                                                            
], function(MessageToast, MessageBox, ODataModel) {                                                                                                                                                                                                            
    'use strict';                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
    return {                                                                                                                                                                                                                                                   
        onCreate: function(oEvent) {                                                                                                                                                                                                                           
            var that = this;                                                                                                                                                                                                                                   
            /// Textos i18n //////////////////////////////////////////////////////////////////////////////                                                                                                                                                     
            var i18nTxt = that.getView().getModel("@i18n").getResourceBundle();                                                                                                                                                                                
            //////////////////////////////////////////////////////////////////////////////////////////////                                                                                                                                                     
                                                                                                                                                                                                                                                               
            let oCtx = this.templateBaseExtension.getExtensionAPI().getSelectedContexts();                                                                                                                                                                     
                                                                                                                                                                                                                                                               
            ///// Inicio da criação do POP UP                                                                                                                                                                                                                  
            var oContent = new sap.ui.layout.VerticalLayout({                                                                                                                                                                                                  
                width: '100%',                                                                                                                                                                                                                                 
                content: [                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                    new sap.m.Label({ text: i18nTxt.getText("LblTAG") }), //                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                    new sap.m.Input('inTAG', {                                                                                                                                                                                                                 
                        width: '100%',                                                                                                                                                                                                                         
                        maxLength: 56,                                                                                                                                                                                                                         
                        showValueHelp: false                                                                                                                                                                                                                   
                    }),                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    new sap.m.Label({ text: i18nTxt.getText("LblQuantidade") }),&nbsp;                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                    new sap.m.Input('inQuantidade', {                                                                                                                                                                                                          
                        width: '100%',                                                                                                                                                                                                                         
                        maxLength: 20,                                                                                                                                                                                                                         
                        required : true,                                                                                                                                                                                                                       
                        editable: false,                                                                                                                                                                                                                       
                        textAlign: "Right",                                                                                                                                                                                                                    
                        showValueHelp: true,                                                                                                                                                                                                                   
                        change: async function () {                                                                                                                                                                                                            
                            //var res = await that.peso(oEvent);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                               
                        }                                                                                                                                                                                                                                      
                    })                                                                                                                                                                                                                                         
                ]                                                                                                                                                                                                                                              
            });&nbsp;                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
            var pressDialog = new sap.m.Dialog({                                                                                                                                                                                                               
                type: 'Message',                                                                                                                                                                                                                               
                title: i18nTxt.getText("titleCriar"),//,                                                                                                                                                                                                       
                resizable: false,                                                                                                                                                                                                                              
                draggable: true,                                                                                                                                                                                                                               
                //titleAlignment: sap.m.TitleAlignment.Start,                                                                                                                                                                                                  
                content: oContent,                                                                                                                                                                                                                             
                buttons: [&nbsp;                                                                                                                                                                                                                               
                    new sap.m.Button({                                                                                                                                                                                                                         
                        type: sap.m.ButtonType.Emphasized,                                                                                                                                                                                                     
                        text: i18nTxt.getText("BtnConfirmar"),                                                                                                                                                                                                 
                        press: async function () {                                                                                                                                                                                                             
                            var res = await that.criar(oEvent);                                                                                                                                                                                                
&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                                       
                            pressDialog.close();&nbsp;                                                                                                                                                                                                         
                            pressDialog.destroy();                                                                                                                                                                                                             
                        }                                                                                                                                                                                                                                      
                    }),                                                                                                                                                                                                                                        
                    new sap.m.Button({                                                                                                                                                                                                                         
                        text: i18nTxt.getText("BtnPesagem"),                                                                                                                                                                                                   
                        press: function () {                                                                                                                                                                                                                   
                            that.peso(oEvent);                                                                                                                                                                                                                 
                        }                                                                                                                                                                                                                                      
                    }),                                                                                                                                                                                                                                        
                    new sap.m.Button({                                                                                                                                                                                                                         
                        text: i18nTxt.getText("BTnCancelar"),                                                                                                                                                                                                  
                        press: function () {                                                                                                                                                                                                                   
                            pressDialog.close();                                                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                    })                                                                                                                                                                                                                                         
                ],                                                                                                                                                                                                                                             
                afterOpen: function () {&nbsp;                                                                                                                                                                                                                 
                    that.peso(oEvent);&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                 
                },                                                                                                                                                                                                                                             
                afterClose: function () {                                                                                                                                                                                                                      
                    pressDialog.destroy();                                                                                                                                                                                                                     
                },                                                                                                                                                                                                                                             
                contentWidth: "20%",                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
            });                                                                                                                                                                                                                                                
            pressDialog.open();                                                                                                                                                                                                                                
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        criar2: async function(oEvent) {                                                                                                                                                                                                                       
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
            var that = this;                                                                                                                                                                                                                                   
            //var oInput = oEvent.getSource();                                                                                                                                                                                                                 
            //var oBindingContext = oEvent.getSource().getBindingContext();                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
            let QRCode = sap.ui.getCore().byId('inTAG').getValue();&nbsp;                                                                                                                                                                                      
            let ConfirmationYieldQuantity = sap.ui.getCore().byId('inQuantidade').getValue();                                                                                                                                                                  
            let url = `/ZC_PP_SHOP_FLOOR`;                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
            this.getView().getModel().create(                                                                                                                                                                                                                  
                url,                                                                                                                                                                                                                                           
                { QRCode, ConfirmationYieldQuantity },                                                                                                                                                                                                         
                {                                                                                                                                                                                                                                              
                    success: function (msg) {                                                                                                                                                                                                                  
                        sap.m.MessageBox.success(msg);                                                                                                                                                                                                         
                        if (msg.results && msg.results.length > 0) {                                                                                                                                                                                           
                            if (msg.results[0].Msgty == 'E') {                                                                                                                                                                                                 
                               // MessageBox.error(msg.results[0].Message);                                                                                                                                                                                    
                            } else {                                                                                                                                                                                                                           
                                //MessageToast.show(msg.results[0].Message);                                                                                                                                                                                   
                            }                                                                                                                                                                                                                                  
                        } else {                                                                                                                                                                                                                               
                           // MessageToast.show("No results found.");                                                                                                                                                                                          
                        }                                                                                                                                                                                                                                      
                    },                                                                                                                                                                                                                                         
                    error: function (oError) {                                                                                                                                                                                                                 
                        var sErrorMessage = "Error accessing the service: " + oError.message;                                                                                                                                                                  
                        MessageBox.error(sErrorMessage);                                                                                                                                                                                                       
                        console.log(sErrorMessage, oError); // Logar o erro no console para depuração                                                                                                                                                          
                    }                                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
            );                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            var fnFunction = function () {&nbsp;                                                                                                                                                                                                               
                return  new Promise(function (fnRes, fnRej) {                                                                                                                                                                                                  
                    that.extensionAPI.invokeActions(                                                                                                                                                                                                           
                        "/gerar_retorno",                                                                                                                                                                                                                      
                        oCtx,                                                                                                                                                                                                                                  
                        {&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                    
                            InfoDanfe,                                                                                                                                                                                                                         
                            Placa,                                                                                                                                                                                                                             
                            ModalidadeFrete,                                                                                                                                                                                                                   
                            AgenteFrete,                                                                                                                                                                                                                       
                            BpCliente,                                                                                                                                                                                                                         
                            QtdRes : lTable[i].QtdReceb                                                                                                                                                                                                        
                        },&nbsp;                                                                                                                                                                                                                               
                    ).then(                                                                                                                                                                                                                                    
                        function (data) {                                                                                                                                                                                                                      
                            fnRes();                                                                                                                                                                                                                           
                    //        fnRej();                                                                                                                                                                                                                         
                            that.templateBaseExtension.getExtensionAPI().refreshTable();                                                                                                                                                                       
                            that.getView().getModel().refresh();                                                                                                                                                                                               
                    }).catch(                                                                                                                                                                                                                                  
                        function(oError){&nbsp;&nbsp;                                                                                                                                                                                                          
                            fnRej();                                                                                                                                                                                                                           
                        }                                                                                                                                                                                                                                      
                    );                                                                                                                                                                                                                                         
                });&nbsp;                                                                                                                                                                                                                                      
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                       
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            var mParameters = {                                                                                                                                                                                                                                
                busy: {                                                                                                                                                                                                                                        
                    set: true,                                                                                                                                                                                                                                 
                    check: false                                                                                                                                                                                                                               
                },                                                                                                                                                                                                                                             
                dataloss: {                                                                                                                                                                                                                                    
                    popup: false,                                                                                                                                                                                                                              
                    navigation: false                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
            };                                                                                                                                                                                                                                                 
            this.extensionAPI.securedExecution(fnFunction, mParameters);                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                               
        },&nbsp;                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        criar: async function(oEvent) {                                                                                                                                                                                                                        
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
            var that = this;                                                                                                                                                                                                                                   
            //var oInput = oEvent.getSource();                                                                                                                                                                                                                 
            //var oBindingContext = oEvent.getSource().getBindingContext();                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
            let TAG = sap.ui.getCore().byId('inTAG').getValue();&nbsp;                                                                                                                                                                                         
            let Quantidade = sap.ui.getCore().byId('inQuantidade').getValue();                                                                                                                                                                                 
            let url = `/CreateCE(P_TAG='${TAG}',P_Quantidade='${Quantidade}')/Set`;                                                                                                                                                                            
                                                                                                                                                                                                                                                               
            this.getView().getModel().read(                                                                                                                                                                                                                    
                url,                                                                                                                                                                                                                                           
                {                                                                                                                                                                                                                                              
                    success: function (msg) {                                                                                                                                                                                                                  
                        if (msg.results && msg.results.length > 0) {                                                                                                                                                                                           
                            if (msg.results[0].Msgty == 'E') {                                                                                                                                                                                                 
                                MessageBox.error(msg.results[0].Message);                                                                                                                                                                                      
                            } else {                                                                                                                                                                                                                           
                                MessageToast.show(msg.results[0].Message);                                                                                                                                                                                     
                            }                                                                                                                                                                                                                                  
                        } else {                                                                                                                                                                                                                               
                            MessageToast.show("No results found.");                                                                                                                                                                                            
                        }                                                                                                                                                                                                                                      
                        that.getView().getModel().refresh();                                                                                                                                                                                                   
                    },                                                                                                                                                                                                                                         
                    error: function (oError) {                                                                                                                                                                                                                 
                        var sErrorMessage = "Error accessing the service: " + oError.message;                                                                                                                                                                  
                        MessageBox.error(sErrorMessage);                                                                                                                                                                                                       
                        console.log(sErrorMessage, oError); // Logar o erro no console para depuração                                                                                                                                                          
                    }                                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
            );                                                                                                                                                                                                                                                 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                               
        },&nbsp;                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        peso: function(oEvent) {                                                                                                                                                                                                                               
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
            let url = `/BalancaCE`;                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
            this.getView().getModel().read(                                                                                                                                                                                                                    
                url,                                                                                                                                                                                                                                           
                {                                                                                                                                                                                                                                              
                    success: function (msg) {                                                                                                                                                                                                                  
                        sap.ui.getCore().byId('inQuantidade').setValue(msg.results[0].peso);                                                                                                                                                                   
                    },                                                                                                                                                                                                                                         
                    error: function (oError) {                                                                                                                                                                                                                 
                        var sErrorMessage = "Error accessing the service: " + oError.message;                                                                                                                                                                  
                        MessageBox.error(sErrorMessage);                                                                                                                                                                                                       
                        console.log(sErrorMessage, oError); // Logar o erro no console para depuração                                                                                                                                                          
                    }                                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
            );                                                                                                                                                                                                                                                 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                               
        }                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
    };                                                                                                                                                                                                                                                         
&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                                       
});                                                                                                                                                                                                                                                            